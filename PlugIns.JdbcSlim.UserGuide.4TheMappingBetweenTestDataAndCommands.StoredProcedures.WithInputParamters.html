<html><head><title>PlugIns.JdbcSlim.UserGuide.4TheMappingBetweenTestDataAndCommands.StoredProcedures.WithInputParamters</title><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><link rel='stylesheet' type='text/css' href='css/fitnesse.css'/><script src='javascript/jquery-1.11.3.min.js' type='text/javascript'></script><script src='javascript/fitnesse.js' type='text/javascript'></script></head><body><header><h2>PlugIns.JdbcSlim.UserGuide.4TheMappingBetweenTestDataAndCommands.StoredProcedures.WithInputParamters</h2></header><article><h2><a href="PlugIns.html">PlugIns</a>
<a href="PlugIns.JdbcSlim.html">JdbcSlim</a>
<a href="PlugIns.JdbcSlim.UserGuide.html">UserGuide</a>
<a href="PlugIns.JdbcSlim.UserGuide.4TheMappingBetweenTestDataAndCommands.html">4TheMappingBetweenTestDataAndCommands</a>
<a href="PlugIns.JdbcSlim.UserGuide.4TheMappingBetweenTestDataAndCommands.StoredProcedures.html">StoredProcedures</a>
</h2></br><br/><br/><div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">To avoid side effects we execute the test in a transaction</p>
	<div><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr>
		<td colspan="3">open Connection</td>
	</tr>
	<tr>
		<td>execute</td>
		<td colspan="2">begin transaction</td>
	</tr>
</table>
<br/></div>
</div>
<br/><h3>Input Parameters</h3>
<br/>To use Input Parameters you have to define a tuple of 3-4 values for each input column.<br/>The values are separated with a ":".<br/>1. Flag for Input or Output Parameter: I* = input parameter, O* = output parameter, I*O* = input and output parameter <br/>2. Position in the statement, the first parameter has number 1<br/>3. Integer number of SQL Type see the jdk java documentation or <a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7u40-b43/java/sql/Types.java#Types.0BIT.html">look here</a><br/>4. The scale of the data type, might be required for VARCHAR, DECIMAL, etc. See the jdbc documentation of your database system. This flag is optional  <br/><br/><h4>These flags are defined in a separate Properties definition.</h4>
<br/><table>
	<tr>
		<td>Define Properties</td>
		<td>inParameters</td>
	</tr>
	<tr>
		<td>key</td>
		<td>value</td>
	</tr>
	<tr>
		<td>FILL</td>
		<td>I:3:12:0</td>
	</tr>
	<tr>
		<td>No</td>
		<td>in:1:8:0</td>
	</tr>
	<tr>
		<td>inStr</td>
		<td>Input:1:12</td>
	</tr>
	<tr>
		<td>c</td>
		<td>i:2:4</td>
	</tr>
</table>
<br/><h4>Link this definition to the query with the <b>dbQueryParameters</b> key</h4>
   <br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select SQRT(?) as root</td>
		<td>dbQueryParameters=inParameters</td>
	</tr>
	<tr>
		<td>No</td>
		<td colspan="3">root?</td>
	</tr>
	<tr>
		<td>9.0</td>
		<td colspan="3">3.0</td>
	</tr>
	<tr>
		<td>16.0</td>
		<td colspan="3">4.0</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select LPAD(?, ?, ?) as myString</td>
		<td>dbQueryParameters=inParameters</td>
	</tr>
	<tr>
		<td>inStr</td>
		<td>c</td>
		<td>FILL</td>
		<td>myString?</td>
	</tr>
	<tr>
		<td>xYz</td>
		<td>7</td>
		<td>*</td>
		<td>****xYz</td>
	</tr>
	<tr>
		<td>ABC</td>
		<td>5</td>
		<td>-</td>
		<td>--ABC</td>
	</tr>
</table>
<br/><h4>Or define the parameters inline in the cmd</h4>
<br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td colspan="2">select LPAD(?{inStr:12}, ?{c:4}, ?{FILL:12}) as myString</td>
	</tr>
	<tr>
		<td>inStr</td>
		<td>c</td>
		<td>FILL</td>
		<td>myString?</td>
	</tr>
	<tr>
		<td>xYz</td>
		<td>7</td>
		<td>*</td>
		<td>****xYz</td>
	</tr>
	<tr>
		<td>ABC</td>
		<td>5</td>
		<td>-</td>
		<td>--ABC</td>
	</tr>
</table>
<br/><div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Rollback the change to not impact future tests</p>
	<div><br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr>
		<td colspan="3">open Connection</td>
	</tr>
	<tr>
		<td>execute</td>
		<td colspan="2">rollback</td>
	</tr>
	<tr>
		<td colspan="3">close Connection</td>
	</tr>
</table>
<br/><h4>Check that the rollback worked</h4>
<table>
	<tr>
		<td>SQLCommand</td>
		<td>StartupDatabase</td>
		<td>select * from TestData</td>
		<td colspan="2">Query</td>
	</tr>
	<tr>
		<td>ID</td>
		<td>Name</td>
		<td>Phone</td>
		<td>City</td>
		<td>Profession</td>
	</tr>
	<tr>
		<td>1</td>
		<td>Bill</td>
		<td>12345</td>
		<td>Berlin</td>
		<td>Doctor</td>
	</tr>
	<tr>
		<td>2</td>
		<td>Ben</td>
		<td>6789</td>
		<td>Denver</td>
		<td>Artist</td>
	</tr>
	<tr>
		<td>3</td>
		<td>Tom</td>
		<td>4567890</td>
		<td>Seoul</td>
		<td>Milkman</td>
	</tr>
	<tr>
		<td>4</td>
		<td>Till</td>
		<td>332211</td>
		<td>Berlin</td>
		<td>Senator</td>
	</tr>
	<tr>
		<td>5</td>
		<td>Sarah</td>
		<td>999999</td>
		<td>Paris</td>
		<td>Hero</td>
	</tr>
	<tr>
		<td>6</td>
		<td>James</td>
		<td>#null#</td>
		<td>London</td>
		<td>Butler</td>
	</tr>
	<tr>
		<td>7</td>
		<td>Bert</td>
		<td>432</td>
		<td>Washington</td>
		<td>President</td>
	</tr>
	<tr>
		<td>8</td>
		<td>Kim</td>
		<td>1</td>
		<td>New York</td>
		<td>Banker</td>
	</tr>
</table>
<br/></div>
</div>
</article></body></html>