
<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <title>PlugIns.JdbcSlim.UserGuide.2KeyBenefits.2TestingOnSideEffects</title>
    <!--[if lt IE 9]>
   <script>
    document.createElement('header');
    document.createElement('nav');
    document.createElement('section');
    document.createElement('article');
    document.createElement('footer');
   </script>
  <![endif]-->
  
  <link rel="shortcut icon" type="image/png" href="../../../resources/images/favicon.png" />
  <link rel="stylesheet" type="text/css" href="../../../resources/css/fitnesse_wiki.css" />
  <link rel="stylesheet" type="text/css" href="../../../resources/css/fitnesse_pages.css" />
  <link rel="stylesheet" type="text/css" href="../../../resources/wysiwyg/wysiwyg.css" media="screen"/>
  <link rel="stylesheet" type="text/css" href="../../../resources/bootstrap/css/fitnesse-bootstrap.css" />

  <script src="../../../resources/javascript/jquery-1.11.3.min.js" type="text/javascript"></script>
  <script src="../../../resources/javascript/fitnesse.js" type="text/javascript"></script>

  <script src="../../../resources/bootstrap/js/bootstrap.js" type="text/javascript"></script>
  <script src="../../../resources/bootstrap/js/respond.js" type="text/javascript"></script>

 </head>
 <body class="wikiPage">

  <nav class="navbar-fixed-top " role="navigation">
   <div class="navbar navbar-default">
   <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
     <ol class="nav navbar-nav"><li><a href="2TestingOnSideEffects.html">2TestingOnSideEffects</a></li></ol>
    </div>

    </nav><ol class="breadcrumb">
 <li><a href="/PlugIns">PlugIns</a></li>
 <li><a href="../../../JdbcSlim.html">JdbcSlim</a></li>
 <li><a href="../../../JdbcSlim/UserGuide.html">UserGuide</a></li>
 <li><a href="../../../JdbcSlim/UserGuide/2KeyBenefits.html">2KeyBenefits</a></li>
 
</ol>

  <header>
      </header>
  
  <article>
   <div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Included page: <a href="../../../JdbcSlim/ScenarioLibrary.html">.PlugIns.JdbcSlim.ScenarioLibrary</a> <a href="../../../JdbcSlim/ScenarioLibrary.html" class="edit"></a></p>
	<div><br/><div class="contents">
	<b>Contents:</b>
	<ul class="toc1"/>
</div>
<br/><br/><div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Included page: <a href="FitNesse.SuiteAcceptanceTests.ScenarioLibrary">.FitNesse.SuiteAcceptanceTests.ScenarioLibrary</a> <a href="FitNesse.SuiteAcceptanceTests.ScenarioLibrary?edit&amp;redirectToReferer=true&amp;redirectAction=" class="edit"></a></p>
	<div><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>given page</td>
		<td>page</td>
		<td>with content</td>
		<td>content</td>
	</tr>
	<tr class="slimRowColor3">
		<td>create page</td>
		<td>@page</td>
		<td>with content</td>
		<td colspan="2">@content</td>
	</tr>
	<tr class="slimRowColor4">
		<td>$IT=</td>
		<td>echo</td>
		<td colspan="3">@page</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>given page</td>
		<td colspan="2">page</td>
	</tr>
	<tr class="slimRowColor2">
		<td>given page</td>
		<td>@page</td>
		<td>with content</td>
		<td>nothing</td>
	</tr>
	<tr class="slimRowColor6">
		<td>$CONTENT=</td>
		<td>echo</td>
		<td colspan="2"></td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>given test page</td>
		<td>page</td>
	</tr>
	<tr class="slimRowColor2">
		<td>given page</td>
		<td colspan="2">@page</td>
	</tr>
	<tr class="slimRowColor4">
		<td>make</td>
		<td>@page</td>
		<td>a test page</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>given slim test page</td>
		<td colspan="2">page</td>
	</tr>
	<tr class="slimRowColor2">
		<td>given page</td>
		<td>@page</td>
		<td>with content</td>
		<td>!define TEST_SYSTEM {slim}</td>
	</tr>
	<tr class="slimRowColor4">
		<td>make</td>
		<td>@page</td>
		<td colspan="2">a test page</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>page</td>
		<td>source</td>
		<td>should have link to</td>
		<td>target</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content contains</td>
		<td colspan="3">&lt;a href="@target"</td>
	</tr>
	<tr class="slimRowColor4">
		<td>$IT=</td>
		<td>echo</td>
		<td colspan="3">@source</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>it should have link to</td>
		<td colspan="2">target</td>
	</tr>
	<tr class="slimRowColor3">
		<td>page</td>
		<td>$IT</td>
		<td>should have link to</td>
		<td>@target</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>and it should have link to</td>
		<td colspan="2">target</td>
	</tr>
	<tr class="slimRowColor3">
		<td>page</td>
		<td>$IT</td>
		<td>should have link to</td>
		<td>@target</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>page</td>
		<td>source</td>
		<td>should have creating link to</td>
		<td>target</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content contains</td>
		<td colspan="3">@target&lt;a title="create page" href="@target?edit&amp;nonExistent=true"&gt;[?]&lt;/a&gt;</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>it should have creating link to</td>
		<td colspan="2">target</td>
	</tr>
	<tr class="slimRowColor3">
		<td>page</td>
		<td>$IT</td>
		<td>should have creating link to</td>
		<td>@target</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>page</td>
		<td>source</td>
		<td>should contain</td>
		<td>text</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content contains</td>
		<td colspan="3">@text</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="4">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>page</td>
		<td>source</td>
		<td>should not contain</td>
		<td>text</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor7">
		<td>reject</td>
		<td>content contains</td>
		<td colspan="3">@text</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="4">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>page</td>
		<td>source</td>
		<td>should match</td>
		<td>text</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content matches</td>
		<td colspan="3">@text</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="4">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>it should contain</td>
		<td colspan="2">text</td>
	</tr>
	<tr class="slimRowColor3">
		<td>page</td>
		<td>$IT</td>
		<td>should contain</td>
		<td>@text</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>it should not contain</td>
		<td colspan="2">text</td>
	</tr>
	<tr class="slimRowColor3">
		<td>page</td>
		<td>$IT</td>
		<td>should not contain</td>
		<td>@text</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>it should contain</td>
		<td>text</td>
		<td>in line</td>
		<td>symbol</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>$IT</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor3">
		<td>$@symbol=</td>
		<td>line number containing</td>
		<td colspan="3">@text</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>it should match</td>
		<td colspan="2">text</td>
	</tr>
	<tr class="slimRowColor3">
		<td>page</td>
		<td>$IT</td>
		<td>should match</td>
		<td>@text</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>test results for page</td>
		<td>source</td>
		<td>should contain</td>
		<td>text</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source?test</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content contains</td>
		<td colspan="3">@text</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="4">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>test results for page in debug mode</td>
		<td>source</td>
		<td>should contain</td>
		<td>text</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source?test&amp;debug</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content contains</td>
		<td colspan="3">@text</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="4">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>test results for suite</td>
		<td>source</td>
		<td>should contain</td>
		<td>text</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source?suite</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content contains</td>
		<td colspan="3">@text</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="4">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>its test results should contain</td>
		<td colspan="2">text</td>
	</tr>
	<tr class="slimRowColor0">
		<td>test results for page</td>
		<td>$IT</td>
		<td>should contain</td>
		<td>@text</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>test ressults for page</td>
		<td>source</td>
		<td>should not contain</td>
		<td>text</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source?test</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor7">
		<td>reject</td>
		<td>content contains</td>
		<td colspan="3">@text</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="4">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>and should contain</td>
		<td>text</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content contains</td>
		<td>@text</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="2">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>and should match</td>
		<td>text</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content matches</td>
		<td>@text</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="2">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>and should not contain</td>
		<td>text</td>
	</tr>
	<tr class="slimRowColor7">
		<td>reject</td>
		<td>content contains</td>
		<td>@text</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="2">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>widget</td>
		<td>wikiText</td>
		<td>should render</td>
		<td>htmlText</td>
	</tr>
	<tr class="slimRowColor3">
		<td>create page</td>
		<td>WidgetPage</td>
		<td>with content</td>
		<td colspan="2">@wikiText</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>WidgetPage</td>
		<td colspan="2">200</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content matches</td>
		<td colspan="3">@htmlText</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="4">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>the line</td>
		<td>after</td>
		<td>should come after</td>
		<td>before</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>echo int</td>
		<td>$@before</td>
		<td colspan="2">&lt; $@after</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td colspan="3">pass</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>echo</td>
		<td>pass</td>
		<td>pass</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>show collapsed</td>
		<td>content</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="2">@content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>show Symbol</td>
		<td>result</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>then</td>
		<td>pass</td>
		<td>assertions pass,</td>
		<td>fail</td>
		<td>fail,</td>
		<td>ignore</td>
		<td>are ignored</td>
		<td>exception</td>
		<td>exceptions thrown</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content matches</td>
		<td colspan="8">Assertions:&lt;[^&lt;]*@pass right, @fail wrong, @ignore ignored, @exception exceptions</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td>extract match;</td>
		<td>Assertions:&lt;[^&lt;]*exceptions</td>
		<td>contents</td>
		<td colspan="6">0</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>and cell</td>
		<td>text</td>
		<td>has result</td>
		<td>result</td>
	</tr>
	<tr class="slimRowColor8">
		<td>ensure</td>
		<td>content matches</td>
		<td colspan="3">class="@result"&gt;@text&lt;</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td>extract match;</td>
		<td>class="[^"]+"&gt;@text&lt;</td>
		<td>contents</td>
		<td>0</td>
	</tr>
</table>
<br/><span class="meta">variable defined: TestSTART=@@@START: Test specific content</span>
 <br/><span class="meta">variable defined: TestEND=@@@END: Test specific content</span>
 <br/><br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>and TestSystem setup is</td>
		<td>content</td>
	</tr>
	<tr class="slimRowColor6">
		<td>$CONTENT=</td>
		<td>echo</td>
		<td>$CONTENT
@content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>and setup content is</td>
		<td>content</td>
	</tr>
	<tr class="slimRowColor6">
		<td>$CONTENT=</td>
		<td>echo</td>
		<td>$CONTENT
@content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>and test content is</td>
		<td colspan="2">content</td>
	</tr>
	<tr class="slimRowColor2">
		<td>given page</td>
		<td>$IT</td>
		<td>with content</td>
		<td>$CONTENT @@@START: Test specific content@content@@@END: Test specific content</td>
	</tr>
	<tr class="slimRowColor4">
		<td>make</td>
		<td>$IT</td>
		<td colspan="2">a test page</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>get HTML result</td>
	</tr>
	<tr class="slimRowColor8">
		<td>start</td>
		<td>Response Examiner.</td>
	</tr>
	<tr class="slimRowColor0">
		<td>setType</td>
		<td>contents</td>
	</tr>
	<tr class="slimRowColor6">
		<td>setPattern</td>
		<td>@@@START: Test specific content[^&lt;]*(.*&gt;)\s*@@@END: Test specific content</td>
	</tr>
	<tr class="slimRowColor7">
		<td>setGroup</td>
		<td>1</td>
	</tr>
	<tr class="slimRowColor0">
		<td>$HTML_Result=</td>
		<td>found</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>get HTML input</td>
	</tr>
	<tr class="slimRowColor8">
		<td>start</td>
		<td>Response Examiner.</td>
	</tr>
	<tr class="slimRowColor0">
		<td>setType</td>
		<td>pageHtml</td>
	</tr>
	<tr class="slimRowColor6">
		<td>setPattern</td>
		<td>@@@START: Test specific content[^&lt;]*(.*&gt;)\s*@@@END: Test specific content</td>
	</tr>
	<tr class="slimRowColor7">
		<td>setGroup</td>
		<td>1</td>
	</tr>
	<tr class="slimRowColor9">
		<td>$HTML_Input=</td>
		<td>found</td>
	</tr>
	<tr class="slimRowColor2">
		<td>show collapsed</td>
		<td>get value</td>
	</tr>
</table>
<br/><br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>get collapsed executon log for page</td>
		<td colspan="2">source</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source?executionLog</td>
		<td>200</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>when page</td>
		<td>source</td>
		<td>is tested</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>request page</td>
		<td>@source?test</td>
		<td>200</td>
	</tr>
	<tr class="slimRowColor2">
		<td>show collapsed</td>
		<td colspan="3">content</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>when page</td>
		<td>source</td>
		<td>is tested and HTML is extracted</td>
	</tr>
	<tr class="slimRowColor9">
		<td>when page</td>
		<td>@source</td>
		<td colspan="2">is tested</td>
	</tr>
	<tr class="slimRowColor4">
		<td colspan="4">get HTML result</td>
	</tr>
	<tr class="slimRowColor3">
		<td colspan="4">get HTML input</td>
	</tr>
</table>
<br/></div>
</div>
<br/><br/><span class="meta">variable defined: Header= !define TestLibInstallPath (${LibInstallPath}!-) 
!define JdbcSlimLib -!(${JdbcSlimLib})!-
***Standard Test Page header
!define TEST_SYSTEM {slim}

!path ${TestLibInstallPath}${JdbcSlimLib}
!path ${TestLibInstallPath}h2-*.jar
!path ${TestLibInstallPath}dbfit-*.jar


|import                 |
|six42.fitnesse.jdbcslim|

!| define table type|
|SQLCommand|as Table|


!|DefineProperties|TestDatabase                      |
|key              |value                             |
|jdbcDriver       |org.h2.Driver                     |
|DBURL            |jdbc:h2:mem:h2db;DB_CLOSE_DELAY=-1|
|DBUSER           |na                                |
|DBPASSWORD       |na                                |
|CMD              |                                  |

-!</span>
<br/><br/><span class="meta">variable defined: StartupText=!-
!|Define Properties|StartupDatabase|
|key               |value          |
|.include          |TestDatabase   |
|dbconnection      |h2init         |
|dbupdatecount     |false          |
|dbgetgeneratedkeys|false          |


!|Script|SQLCommand                                                   |StartupDatabase                                                  |
|openConnection                                                                                                                         |
|execute|drop table if exists TestData                                                                                                  |
|show   |success                                                                                                                        |
|show   |rawResult                                                                                                                      |
|show   |resultSheet                                                                                                                    |
|execute|create table TestData (Id int identity(1,1), Name varchar(255), Phone varchar(255), City varchar(255), Profession varchar(255))|
|show   |success                                                                                                                        |
|show   |rawResult                                                                                                                      |
|show   |resultSheet                                                                                                                    |

!|SQLCommand      |StartupDatabase|insert into TestData values (DEFAULT, '%Name%', '%Phone%', '%City%', '%Profession%')|dbgetgeneratedkeys|
|SCOPE_IDENTITY()?|City           |Name                                                                                |Phone  |Profession|
|1                |Berlin         |Bill                                                                                |12345  |Doctor    |
|2                |Denver         |Ben                                                                                 |6789   |Artist    |
|3                |Seoul          |Tom                                                                                 |4567890|Milkman   |
|4                |Berlin         |Till                                                                                |332211 |Senator   |
|5                |Paris          |Sarah                                                                               |999999 |Hero      |
|6                |London         |James                                                                               |5432   |Butler    |
|7                |Washington     |Bert                                                                                |432    |President |
|8                |New York       |Kim                                                                                 |1      |Banker    |

!|SQLCommand|StartupDatabase|select * from TestData|Query                |
|ID         |Name           |Phone                 |City      |Profession|
|1          |Bill           |12345                 |Berlin    |Doctor    |
|2          |Ben            |6789                  |Denver    |Artist    |
|3          |Tom            |4567890               |Seoul     |Milkman   |
|4          |Till           |332211                |Berlin    |Senator   |
|5          |Sarah          |999999                |Paris     |Hero      |
|6          |James          |5432                  |London    |Butler    |
|7          |Bert           |432                   |Washington|President |
|8          |Kim            |1                     |New York  |Banker    |

!|Script|SQLCommand|StartupDatabase|
|closeConnection                   |

-!</span>
<br/><br/><br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>given Jdbc Slim test page</td>
		<td>page</td>
	</tr>
	<tr class="slimRowColor2">
		<td>given test page</td>
		<td colspan="2">@page</td>
	</tr>
	<tr class="slimRowColor7">
		<td>and Test System setup is</td>
		<td colspan="2">!define TestLibInstallPath (./plugins/jdbcslim/) 
!define JdbcSlimLib (jdbcslim*.jar)
***Standard Test Page header
!define TEST_SYSTEM {slim}

!path ${TestLibInstallPath}${JdbcSlimLib}
!path ${TestLibInstallPath}h2-*.jar
!path ${TestLibInstallPath}dbfit-*.jar


|import                 |
|six42.fitnesse.jdbcslim|

!| define table type|
|SQLCommand|as Table|


!|DefineProperties|TestDatabase                      |
|key              |value                             |
|jdbcDriver       |org.h2.Driver                     |
|DBURL            |jdbc:h2:mem:h2db;DB_CLOSE_DELAY=-1|
|DBUSER           |na                                |
|DBPASSWORD       |na                                |
|CMD              |                                  |

</td>
	</tr>
	<tr class="slimRowColor5">
		<td>and Setup content is</td>
		<td colspan="2">
!|Define Properties|StartupDatabase|
|key               |value          |
|.include          |TestDatabase   |
|dbconnection      |h2init         |
|dbupdatecount     |false          |
|dbgetgeneratedkeys|false          |


!|Script|SQLCommand                                                   |StartupDatabase                                                  |
|openConnection                                                                                                                         |
|execute|drop table if exists TestData                                                                                                  |
|show   |success                                                                                                                        |
|show   |rawResult                                                                                                                      |
|show   |resultSheet                                                                                                                    |
|execute|create table TestData (Id int identity(1,1), Name varchar(255), Phone varchar(255), City varchar(255), Profession varchar(255))|
|show   |success                                                                                                                        |
|show   |rawResult                                                                                                                      |
|show   |resultSheet                                                                                                                    |

!|SQLCommand      |StartupDatabase|insert into TestData values (DEFAULT, '%Name%', '%Phone%', '%City%', '%Profession%')|dbgetgeneratedkeys|
|SCOPE_IDENTITY()?|City           |Name                                                                                |Phone  |Profession|
|1                |Berlin         |Bill                                                                                |12345  |Doctor    |
|2                |Denver         |Ben                                                                                 |6789   |Artist    |
|3                |Seoul          |Tom                                                                                 |4567890|Milkman   |
|4                |Berlin         |Till                                                                                |332211 |Senator   |
|5                |Paris          |Sarah                                                                               |999999 |Hero      |
|6                |London         |James                                                                               |5432   |Butler    |
|7                |Washington     |Bert                                                                                |432    |President |
|8                |New York       |Kim                                                                                 |1      |Banker    |

!|SQLCommand|StartupDatabase|select * from TestData|Query                |
|ID         |Name           |Phone                 |City      |Profession|
|1          |Bill           |12345                 |Berlin    |Doctor    |
|2          |Ben            |6789                  |Denver    |Artist    |
|3          |Tom            |4567890               |Seoul     |Milkman   |
|4          |Till           |332211                |Berlin    |Senator   |
|5          |Sarah          |999999                |Paris     |Hero      |
|6          |James          |5432                  |London    |Butler    |
|7          |Bert           |432                   |Washington|President |
|8          |Kim            |1                     |New York  |Banker    |

!|Script|SQLCommand|StartupDatabase|
|closeConnection                   |

</td>
	</tr>
</table>
<br/><br/><table>
	<tr class="slimRowTitle">
		<td>scenario</td>
		<td>and JDBC Slim content is</td>
		<td colspan="2">content</td>
	</tr>
	<tr class="slimRowColor2">
		<td>given page</td>
		<td>$IT</td>
		<td>with content</td>
		<td>!define TestLibInstallPath (./plugins/jdbcslim/) 
!define JdbcSlimLib (jdbcslim*.jar)
***Standard Test Page header
!define TEST_SYSTEM {slim}

!path ${TestLibInstallPath}${JdbcSlimLib}
!path ${TestLibInstallPath}h2-*.jar
!path ${TestLibInstallPath}dbfit-*.jar


|import                 |
|six42.fitnesse.jdbcslim|

!| define table type|
|SQLCommand|as Table|


!|DefineProperties|TestDatabase                      |
|key              |value                             |
|jdbcDriver       |org.h2.Driver                     |
|DBURL            |jdbc:h2:mem:h2db;DB_CLOSE_DELAY=-1|
|DBUSER           |na                                |
|DBPASSWORD       |na                                |
|CMD              |                                  |


!|Define Properties|StartupDatabase|
|key               |value          |
|.include          |TestDatabase   |
|dbconnection      |h2init         |
|dbupdatecount     |false          |
|dbgetgeneratedkeys|false          |


!|Script|SQLCommand                                                   |StartupDatabase                                                  |
|openConnection                                                                                                                         |
|execute|drop table if exists TestData                                                                                                  |
|show   |success                                                                                                                        |
|show   |rawResult                                                                                                                      |
|show   |resultSheet                                                                                                                    |
|execute|create table TestData (Id int identity(1,1), Name varchar(255), Phone varchar(255), City varchar(255), Profession varchar(255))|
|show   |success                                                                                                                        |
|show   |rawResult                                                                                                                      |
|show   |resultSheet                                                                                                                    |

!|SQLCommand      |StartupDatabase|insert into TestData values (DEFAULT, '%Name%', '%Phone%', '%City%', '%Profession%')|dbgetgeneratedkeys|
|SCOPE_IDENTITY()?|City           |Name                                                                                |Phone  |Profession|
|1                |Berlin         |Bill                                                                                |12345  |Doctor    |
|2                |Denver         |Ben                                                                                 |6789   |Artist    |
|3                |Seoul          |Tom                                                                                 |4567890|Milkman   |
|4                |Berlin         |Till                                                                                |332211 |Senator   |
|5                |Paris          |Sarah                                                                               |999999 |Hero      |
|6                |London         |James                                                                               |5432   |Butler    |
|7                |Washington     |Bert                                                                                |432    |President |
|8                |New York       |Kim                                                                                 |1      |Banker    |

!|SQLCommand|StartupDatabase|select * from TestData|Query                |
|ID         |Name           |Phone                 |City      |Profession|
|1          |Bill           |12345                 |Berlin    |Doctor    |
|2          |Ben            |6789                  |Denver    |Artist    |
|3          |Tom            |4567890               |Seoul     |Milkman   |
|4          |Till           |332211                |Berlin    |Senator   |
|5          |Sarah          |999999                |Paris     |Hero      |
|6          |James          |5432                  |London    |Butler    |
|7          |Bert           |432                   |Washington|President |
|8          |Kim            |1                     |New York  |Banker    |

!|Script|SQLCommand|StartupDatabase|
|closeConnection                   |

 @@@START: Test specific content
@content 
@@@END: Test specific content</td>
	</tr>
	<tr class="slimRowColor4">
		<td>make</td>
		<td>$IT</td>
		<td colspan="2">a test page</td>
	</tr>
</table>
<br/><br/></div>
</div>
<div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Included page: <a href="../../../JdbcSlim/SuiteSetUp.html">.PlugIns.JdbcSlim.SuiteSetUp</a> <a href="../../../JdbcSlim/SuiteSetUp.html" class="edit"></a></p>
	<div><br/><br/><div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Setup jdbcSlim</p>
	<div><table>
	<tr class="slimRowTitle">
		<td>import</td>
	</tr>
	<tr class="slimRowColor0">
		<td>six42.fitnesse.jdbcslim</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td colspan="2">define table type</td>
	</tr>
	<tr>
		<td>SQLCommand</td>
		<td>as Table</td>
	</tr>
</table>
<br/></div>
</div>
<div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Driver specific setup </p>
	<div><span class="meta">classpath: ./plugins/jdbcslim/h2-*.jar</span><br/><br/><table>
	<tr>
		<td>Define Properties</td>
		<td>TestDatabase</td>
	</tr>
	<tr>
		<td>key</td>
		<td>value</td>
	</tr>
	<tr>
		<td>jdbcDriver</td>
		<td>org.h2.Driver</td>
	</tr>
	<tr>
		<td>#DBURL</td>
		<td>jdbc:h2:~/h2db</td>
	</tr>
	<tr>
		<td>DBURL</td>
		<td>jdbc:h2:mem:h2db;DB_CLOSE_DELAY=-1</td>
	</tr>
	<tr>
		<td>DBUSER</td>
		<td>na</td>
	</tr>
	<tr>
		<td>DBPASSWORD</td>
		<td>na</td>
	</tr>
	<tr>
		<td>#DBAUTOCOMMIT</td>
		<td>true</td>
	</tr>
	<tr>
		<td>CMD</td>
		<td></td>
	</tr>
</table>
<br/></div>
</div>
<div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Create database and add data</p>
	<div><br/><table>
	<tr>
		<td>Define Properties</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr>
		<td>key</td>
		<td>value</td>
	</tr>
	<tr>
		<td>.include</td>
		<td>TestDatabase</td>
	</tr>
	<tr>
		<td>dbconnection</td>
		<td>h2WithTransaction</td>
	</tr>
</table>
<br/><br/><table>
	<tr>
		<td>Define Properties</td>
		<td>StartupDatabase</td>
	</tr>
	<tr>
		<td>key</td>
		<td>value</td>
	</tr>
	<tr>
		<td>.include</td>
		<td>TestDatabase</td>
	</tr>
	<tr>
		<td>dbconnection</td>
		<td>h2init</td>
	</tr>
	<tr>
		<td>dbupdatecount</td>
		<td>false</td>
	</tr>
	<tr>
		<td>dbgetgeneratedkeys</td>
		<td>false</td>
	</tr>
</table>
<br/><br/><table>
	<tr class="slimRowTitle">
		<td>Script</td>
		<td>SQLCommand</td>
		<td>StartupDatabase</td>
	</tr>
	<tr class="slimRowColor4">
		<td colspan="3">openConnection</td>
	</tr>
	<tr class="slimRowColor5">
		<td>execute</td>
		<td colspan="2">drop table if exists TestData</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="2">success</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="2">rawResult</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="2">resultSheet</td>
	</tr>
	<tr class="slimRowColor5">
		<td>execute</td>
		<td colspan="2">create table TestData (Id int identity(1,1), Name varchar(255), Phone long, City varchar(255), Profession varchar(255))</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="2">success</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="2">rawResult</td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="2">resultSheet</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>StartupDatabase</td>
		<td>insert into TestData
values (DEFAULT, '%Name%', %Phone%, '%City%', '%Profession%')</td>
		<td colspan="2">dbgetgeneratedkeys</td>
	</tr>
	<tr>
		<td>SCOPE_IDENTITY()?</td>
		<td>City</td>
		<td>Name</td>
		<td>Phone</td>
		<td>Profession</td>
	</tr>
	<tr>
		<td>1</td>
		<td>Berlin</td>
		<td>Bill</td>
		<td>12345</td>
		<td>Doctor</td>
	</tr>
	<tr>
		<td>2</td>
		<td>Denver</td>
		<td>Ben</td>
		<td>6789</td>
		<td>Artist</td>
	</tr>
	<tr>
		<td>3</td>
		<td>Seoul</td>
		<td>Tom</td>
		<td>4567890</td>
		<td>Milkman</td>
	</tr>
	<tr>
		<td>4</td>
		<td>Berlin</td>
		<td>Till</td>
		<td>332211</td>
		<td>Senator</td>
	</tr>
	<tr>
		<td>5</td>
		<td>Paris</td>
		<td>Sarah</td>
		<td>999999</td>
		<td>Hero</td>
	</tr>
	<tr>
		<td>6</td>
		<td>London</td>
		<td>James</td>
		<td>#null#</td>
		<td>Butler</td>
	</tr>
	<tr>
		<td>7</td>
		<td>Washington</td>
		<td>Bert</td>
		<td>432</td>
		<td>President</td>
	</tr>
	<tr>
		<td>8</td>
		<td>New York</td>
		<td>Kim</td>
		<td>1</td>
		<td>Banker</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>StartupDatabase</td>
		<td>select * from TestData</td>
		<td colspan="2">Query</td>
	</tr>
	<tr>
		<td>ID</td>
		<td>Name</td>
		<td>Phone</td>
		<td>City</td>
		<td>Profession</td>
	</tr>
	<tr>
		<td>1</td>
		<td>Bill</td>
		<td>12345</td>
		<td>Berlin</td>
		<td>Doctor</td>
	</tr>
	<tr>
		<td>2</td>
		<td>Ben</td>
		<td>6789</td>
		<td>Denver</td>
		<td>Artist</td>
	</tr>
	<tr>
		<td>3</td>
		<td>Tom</td>
		<td>4567890</td>
		<td>Seoul</td>
		<td>Milkman</td>
	</tr>
	<tr>
		<td>4</td>
		<td>Till</td>
		<td>332211</td>
		<td>Berlin</td>
		<td>Senator</td>
	</tr>
	<tr>
		<td>5</td>
		<td>Sarah</td>
		<td>999999</td>
		<td>Paris</td>
		<td>Hero</td>
	</tr>
	<tr>
		<td>6</td>
		<td>James</td>
		<td>#null#</td>
		<td>London</td>
		<td>Butler</td>
	</tr>
	<tr>
		<td>7</td>
		<td>Bert</td>
		<td>432</td>
		<td>Washington</td>
		<td>President</td>
	</tr>
	<tr>
		<td>8</td>
		<td>Kim</td>
		<td>1</td>
		<td>New York</td>
		<td>Banker</td>
	</tr>
</table>
<br/><table>
	<tr class="slimRowTitle">
		<td>Script</td>
		<td>SQLCommand</td>
		<td>StartupDatabase</td>
	</tr>
	<tr class="slimRowColor4">
		<td colspan="3">closeConnection</td>
	</tr>
</table>
<br/></div>
</div>
</div>
</div>
<br/>To test that code is working it is not enough to check that the code changed the expected data.<br/>It must also be tested that no other data got changed.<br/><br/>JdbcSlim<a title="create page" href="../../../JdbcSlim/UserGuide/2KeyBenefits/JdbcSlim.html">[?]</a> supports this in the following way.<br/><br/>Going back to our initial example where Ben and Sarah moved location.<br/>Additional we want to check that no other user got moved.<br/><br/><h3 id="Definethequery">Define the query</h3>
<table>
	<tr>
		<td>Define Properties</td>
		<td>SideEffectCheck</td>
	</tr>
	<tr>
		<td>key</td>
		<td>value</td>
	</tr>
	<tr>
		<td>.include</td>
		<td>TestDatabase</td>
	</tr>
	<tr>
		<td>cmd</td>
		<td>select * from TestData where Name not in ('Ben', 'Sarah')</td>
	</tr>
	<tr>
		<td>#</td>
		<td>The 'query' flag below tells SQL Command that this statement will return more than one row</td>
	</tr>
	<tr>
		<td>query</td>
		<td>true</td>
	</tr>
</table>
<br/><h3 id="Storethedataoftheotherpeoplebeforethetest">Store the data of the other people before the test</h3>
<br/><table>
	<tr class="slimRowTitle">
		<td>Script</td>
		<td>SQLCommand</td>
		<td>SideEffectCheck</td>
	</tr>
	<tr class="slimRowColor8">
		<td colspan="3">open connection</td>
	</tr>
	<tr class="slimRowColor5">
		<td colspan="3">execute</td>
	</tr>
	<tr class="slimRowColor7">
		<td>$RSBefore=</td>
		<td colspan="2">resultSheet</td>
	</tr>
	<tr class="slimRowColor8">
		<td colspan="3">close connection</td>
	</tr>
</table>
<br/><br/><h3 id="Runthetest">Run the test</h3>
<br/><div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Included page: <a href="../../../JdbcSlim/UserGuide/1ASimpleExample.html">.PlugIns.JdbcSlim.UserGuide.1ASimpleExample</a> <a href="../../../JdbcSlim/UserGuide/1ASimpleExample.html" class="edit"></a></p>
	<div>Most Tests require three steps.<br/>1. Preparing test data<br/>2. Execution some business functions<br/>3. Validating the impact on the test data<br/><br/>Lets assume we have a database with some information about people and a we need to test a business function that relocates a person into a new city.  <br/><br/><h3 id="1Preparingtestdata">1 Preparing test data</h3>
<br/>To avoid side effects we execute the test in a transaction<br/><table>
	<tr class="slimRowTitle">
		<td>Script</td>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr class="slimRowColor6">
		<td colspan="3">open Connection</td>
	</tr>
	<tr class="slimRowColor5">
		<td>execute</td>
		<td colspan="2">begin transaction</td>
	</tr>
</table>
<br/>To prepare test data two approaches are possible:<br/>1.1 Inserting new data into a database<br/>1.2 Finding suitable existing data in the database<br/><br/><br/>In this examples we use the second approach and find the ID of users named Ben and Sarah which should move. <br/>We store the Id of the users in a Slim Symbol '$TestID' for future reference.<br/><br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select ID, NAME from TestData where Name ='%NAME%'</td>
	</tr>
	<tr>
		<td>ID?</td>
		<td colspan="2">NAME</td>
	</tr>
	<tr>
		<td>$TestID1=</td>
		<td colspan="2">Ben</td>
	</tr>
	<tr>
		<td>$TestID2=</td>
		<td colspan="2">Sarah</td>
	</tr>
</table>
<br/>Before we proceed we validate that Ben and Sarah still live in the old Cities: Denver and Paris<br/><br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select City from TestData where ID ='%ID%'</td>
	</tr>
	<tr>
		<td>ID</td>
		<td colspan="2">CITY?</td>
	</tr>
	<tr>
		<td>$TestID1</td>
		<td colspan="2">Denver</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td colspan="2">Paris</td>
	</tr>
</table>
<br/><h3 id="Executionsomebusinessfunctions">Execution some business functions</h3>
<br/>Here calls to your business code will go.<br/>A simple update statement which can do the job is given below.<br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>update TestData set City='%NewCITY%' where ID ='%ID%'</td>
		<td></td>
	</tr>
	<tr>
		<td>ID</td>
		<td>NewCITY</td>
		<td colspan="2">Count?</td>
	</tr>
	<tr>
		<td>$TestID1</td>
		<td>HongKong</td>
		<td colspan="2">1</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td>Tokyo</td>
		<td colspan="2">1</td>
	</tr>
</table>
<br/><br/><h3 id="Validatingtheimpactonthetestdata">Validating the impact on the test data</h3>
<br/>Finally we check that Ben now lives in Hong Kong and Sarah in Tokyo<br/><br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select City from TestData where ID ='%ID%'</td>
	</tr>
	<tr>
		<td>ID</td>
		<td colspan="2">CITY?</td>
	</tr>
	<tr>
		<td>$TestID1</td>
		<td colspan="2">HongKong</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td colspan="2">Tokyo</td>
	</tr>
</table>
<br/><h3 id="Rollbackthechangetonotimpactfuturetests">Rollback the change to not impact future tests</h3>
<br/><table>
	<tr class="slimRowTitle">
		<td>Script</td>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr class="slimRowColor6">
		<td colspan="3">open Connection</td>
	</tr>
	<tr class="slimRowColor5">
		<td>execute</td>
		<td colspan="2">rollback</td>
	</tr>
	<tr class="slimRowColor6">
		<td colspan="3">close Connection</td>
	</tr>
</table>
<br/><h4 id="Checkthattherollbackworked">Check that the rollback worked</h4>
<table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select City from TestData where ID ='%ID%'</td>
	</tr>
	<tr>
		<td>ID</td>
		<td colspan="2">CITY?</td>
	</tr>
	<tr>
		<td>$TestID1</td>
		<td colspan="2">Denver</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td colspan="2">Paris</td>
	</tr>
</table>
<br/><br/><div class="contents">
	<b>Contents:</b>
	<ul class="toc1"/>
</div>
</div>
</div>
 <br/><br/><br/><h3 id="Comparethedataoftheotherpeopleafterthetest.">Compare the data of the other people after the test.</h3>
<br/><table>
	<tr class="slimRowTitle">
		<td>Script</td>
		<td>SQLCommand</td>
		<td>SideEffectCheck</td>
	</tr>
	<tr class="slimRowColor8">
		<td colspan="3">open connection</td>
	</tr>
	<tr class="slimRowColor5">
		<td colspan="3">execute</td>
	</tr>
	<tr class="slimRowColor0">
		<td>$RSAfter=</td>
		<td colspan="2">resultSheet</td>
	</tr>
	<tr class="slimRowColor9">
		<td>$RSDiff=</td>
		<td>compareSheet</td>
		<td>$RSBefore</td>
	</tr>
	<tr class="slimRowColor8">
		<td colspan="3">close connection</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>Table:SheetEcho</td>
		<td>$RSDiff</td>
	</tr>
</table>




    
 </body>
</html>
