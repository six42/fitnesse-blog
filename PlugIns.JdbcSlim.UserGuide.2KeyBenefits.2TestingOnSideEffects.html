<html><head><title>PlugIns.JdbcSlim.UserGuide.2KeyBenefits.2TestingOnSideEffects</title><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><link rel='stylesheet' type='text/css' href='css/fitnesse.css'/><script src='javascript/jquery-1.11.3.min.js' type='text/javascript'></script><script src='javascript/fitnesse.js' type='text/javascript'></script></head><body><header><h2>PlugIns.JdbcSlim.UserGuide.2KeyBenefits.2TestingOnSideEffects</h2></header><article><h2><a href="PlugIns.html">PlugIns</a>
<a href="PlugIns.JdbcSlim.html">JdbcSlim</a>
<a href="PlugIns.JdbcSlim.UserGuide.html">UserGuide</a>
<a href="PlugIns.JdbcSlim.UserGuide.2KeyBenefits.html">2KeyBenefits</a>
</h2></br><br/>To test that code is working it is not enough to check that the code changed the expected data.<br/>It must also be tested that no other data got changed.<br/><br/>JdbcSlim<a title="create page" href="PlugIns.JdbcSlim.UserGuide.2KeyBenefits.JdbcSlim?edit&amp;nonExistent=true.html">[?]</a> supports this in the following way.<br/><br/>Going back to our initial example where Ben and Sarah moved location.<br/>Additional we want to check that no other user got moved.<br/><br/><h3>Define the query</h3>
<table>
	<tr>
		<td>Define Properties</td>
		<td>SideEffectCheck</td>
	</tr>
	<tr>
		<td>key</td>
		<td>value</td>
	</tr>
	<tr>
		<td>.include</td>
		<td>TestDatabase</td>
	</tr>
	<tr>
		<td>cmd</td>
		<td>select * from TestData where Name not in ('Ben', 'Sarah')</td>
	</tr>
	<tr>
		<td>#</td>
		<td>The 'query' flag below tells SQL Command that this statement will return more than one row</td>
	</tr>
	<tr>
		<td>query</td>
		<td>true</td>
	</tr>
</table>
<br/><h3>Store the data of the other people before the test</h3>
<br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>SideEffectCheck</td>
	</tr>
	<tr>
		<td colspan="3">open connection</td>
	</tr>
	<tr>
		<td colspan="3">execute</td>
	</tr>
	<tr>
		<td>$RSBefore=</td>
		<td colspan="2">resultSheet</td>
	</tr>
	<tr>
		<td colspan="3">close connection</td>
	</tr>
</table>
<br/><br/><h3>Run the test</h3>
<br/><div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Included page: <a href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.html">.PlugIns.JdbcSlim.UserGuide.1ASimpleExample</a> <a href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample?edit&amp;redirectToReferer=true&amp;redirectAction=.html" class="edit"></a></p>
	<div>Most Tests require three steps.<br/>1. Preparing test data<br/>2. Execution some business functions<br/>3. Validating the impact on the test data<br/><br/>Lets assume we have a database with some information about people and a we need to test a business function that relocates a person into a new city.  <br/><br/><h3>1 Preparing test data</h3>
<br/>To avoid side effects we execute the test in a transaction<br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr>
		<td colspan="3">open Connection</td>
	</tr>
	<tr>
		<td>execute</td>
		<td colspan="2">begin transaction</td>
	</tr>
</table>
<br/>To prepare test data two approaches are possible:<br/>1.1 Inserting new data into a database<br/>1.2 Finding suitable existing data in the database<br/><br/><br/>In this examples we use the second approach and find the ID of users named Ben and Sarah which should move. <br/>We store the Id of the users in a Slim Symbol '$TestID' for future reference.<br/><br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select ID, NAME from TestData where Name ='%NAME%'</td>
	</tr>
	<tr>
		<td>ID?</td>
		<td colspan="2">NAME</td>
	</tr>
	<tr>
		<td>$TestID1=</td>
		<td colspan="2">Ben</td>
	</tr>
	<tr>
		<td>$TestID2=</td>
		<td colspan="2">Sarah</td>
	</tr>
</table>
<br/>Before we proceed we validate that Ben and Sarah still live in the old Cities: Denver and Paris<br/><br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select City from TestData where ID ='%ID%'</td>
	</tr>
	<tr>
		<td>ID</td>
		<td colspan="2">CITY?</td>
	</tr>
	<tr>
		<td>$TestID1</td>
		<td colspan="2">Denver</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td colspan="2">Paris</td>
	</tr>
</table>
<br/><h3>Execution some business functions</h3>
<br/>Here calls to your business code will go.<br/>A simple update statement which can do the job is given below.<br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>update TestData set City='%NewCITY%' where ID ='%ID%'</td>
		<td></td>
	</tr>
	<tr>
		<td>ID</td>
		<td>NewCITY</td>
		<td colspan="2">Count?</td>
	</tr>
	<tr>
		<td>$TestID1</td>
		<td>HongKong</td>
		<td colspan="2">1</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td>Tokyo</td>
		<td colspan="2">1</td>
	</tr>
</table>
<br/><br/><h3>Validating the impact on the test data</h3>
<br/>Finally we check that Ben now lives in Hong Kong and Sarah in Tokyo<br/><br/><table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select City from TestData where ID ='%ID%'</td>
	</tr>
	<tr>
		<td>ID</td>
		<td colspan="2">CITY?</td>
	</tr>
	<tr>
		<td>$TestID1</td>
		<td colspan="2">HongKong</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td colspan="2">Tokyo</td>
	</tr>
</table>
<br/><h3>Rollback the change to not impact future tests</h3>
<br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr>
		<td colspan="3">open Connection</td>
	</tr>
	<tr>
		<td>execute</td>
		<td colspan="2">rollback</td>
	</tr>
	<tr>
		<td colspan="3">close Connection</td>
	</tr>
</table>
<br/><h4>Check that the rollback worked</h4>
<table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select City from TestData where ID ='%ID%'</td>
	</tr>
	<tr>
		<td>ID</td>
		<td colspan="2">CITY?</td>
	</tr>
	<tr>
		<td>$TestID1</td>
		<td colspan="2">Denver</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td colspan="2">Paris</td>
	</tr>
</table>
<br/><br/><div class="contents">
	<b>Contents:</b>
	<ul class="toc1"/>
</div>
</div>
</div>
 <br/><br/><br/><h3>Compare the data of the other people after the test.</h3>
<br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>SideEffectCheck</td>
	</tr>
	<tr>
		<td colspan="3">open connection</td>
	</tr>
	<tr>
		<td colspan="3">execute</td>
	</tr>
	<tr>
		<td>$RSAfter=</td>
		<td colspan="2">resultSheet</td>
	</tr>
	<tr>
		<td>$RSDiff=</td>
		<td>compareSheet</td>
		<td>$RSBefore</td>
	</tr>
	<tr>
		<td colspan="3">close connection</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>Table:SheetEcho</td>
		<td>$RSDiff</td>
	</tr>
</table>
</article></body></html>