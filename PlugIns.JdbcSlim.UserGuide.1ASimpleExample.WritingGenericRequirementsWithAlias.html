<html><head><title>PlugIns.JdbcSlim.UserGuide.1ASimpleExample.WritingGenericRequirementsWithAlias</title><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><link rel='stylesheet' type='text/css' href='css/fitnesse.css'/><script src='javascript/jquery-1.11.3.min.js' type='text/javascript'></script><script src='javascript/fitnesse.js' type='text/javascript'></script></head><body><header><h2>PlugIns.JdbcSlim.UserGuide.1ASimpleExample.WritingGenericRequirementsWithAlias</h2></header><article><h2><a href="PlugIns.html">PlugIns</a>
<a href="PlugIns.JdbcSlim.html">JdbcSlim</a>
<a href="PlugIns.JdbcSlim.UserGuide.html">UserGuide</a>
<a href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.html">1ASimpleExample</a>
</h2></br><br/>Requirements should not contain SQL code:<br/><br/><ul>
	<li>Not everybody understands SQL commands. But you want that the requirements can be understood by anybody.</li>
	<li>The SQL Code can change if a different implementation is chosen. But the requirements should not change in this case. They should be independent of the implementation.</li>
</ul>
 <br/>This can be achieved easily with JdbcSlim<a title="create page" href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.JdbcSlim?edit&amp;nonExistent=true.html">[?]</a>.<br/><br/>Lets rewrite the first example with Ben and Sarah but write it in less technical terms.   <br/>The SQL Code can be moved into a seperate SetUp<a title="create page" href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.SetUp?edit&amp;nonExistent=true.html">[?]</a> page.<br/><br/><div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Included page: <a href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.WritingGenericRequirementsWithAlias.SqlSetUp.html">&gt;SqlSetUp</a> <a href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.WritingGenericRequirementsWithAlias.SqlSetUp?edit&amp;redirectToReferer=true&amp;redirectAction=.html" class="edit"></a></p>
	<div><table>
	<tr>
		<td>Define Properties</td>
		<td>FindTestUserIDs</td>
	</tr>
	<tr>
		<td>key</td>
		<td>value</td>
	</tr>
	<tr>
		<td>.include</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr>
		<td>cmd</td>
		<td>select ID, NAME from TestData where Name ='%NAME%'</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>Define Properties</td>
		<td>CheckInitalCityOfUsers</td>
	</tr>
	<tr>
		<td>key</td>
		<td>value</td>
	</tr>
	<tr>
		<td>.include</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr>
		<td>cmd</td>
		<td>select City from TestData where ID ='%ID%'</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>Define Properties</td>
		<td>RelocateUserToNewCity</td>
	</tr>
	<tr>
		<td>key</td>
		<td>value</td>
	</tr>
	<tr>
		<td>.include</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr>
		<td>cmd</td>
		<td>update TestData set City='%NewCITY%' where ID ='%ID%'</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>Define Properties</td>
		<td>CheckFinalCityOfUsers</td>
	</tr>
	<tr>
		<td>key</td>
		<td>value</td>
	</tr>
	<tr>
		<td>.include</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr>
		<td>cmd</td>
		<td>select City from TestData where ID ='%ID%'</td>
	</tr>
</table>
<br/><br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>FindTestUserIDs</td>
	</tr>
	<tr>
		<td>$FTU=</td>
		<td colspan="2">get fixture</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td colspan="2">Define alias</td>
	</tr>
	<tr>
		<td>find test users</td>
		<td>table: $FTU</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>CheckInitalCityOfUsers</td>
	</tr>
	<tr>
		<td>$CICoU=</td>
		<td colspan="2">get fixture</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td colspan="2">Define alias</td>
	</tr>
	<tr>
		<td>check first city of users</td>
		<td>table: $CICoU</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>RelocateUserToNewCity</td>
	</tr>
	<tr>
		<td>$RUTNC=</td>
		<td colspan="2">get fixture</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td colspan="2">Define alias</td>
	</tr>
	<tr>
		<td>relocate users</td>
		<td>table: $RUTNC</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>CheckFinalCityOfUsers</td>
	</tr>
	<tr>
		<td>$CFCoU=</td>
		<td colspan="2">get fixture</td>
	</tr>
</table>
<br/><table>
	<tr>
		<td colspan="2">Define alias</td>
	</tr>
	<tr>
		<td>Check city after relocation</td>
		<td>table: $CFCoU</td>
	</tr>
</table>
<br/><br/><br/>To avoid side effects we execute the test in a transaction<br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
	</tr>
	<tr>
		<td colspan="3">open Connection</td>
	</tr>
	<tr>
		<td>execute</td>
		<td colspan="2">begin transaction</td>
	</tr>
</table>
</div>
</div>
<br/><br/><h3>1 Preparing test data</h3>
<br/>Find the ID of users named Ben and Sarah which should move. <br/>We store the Id of the users in a Slim Symbol '$TestID' for future reference.<br/><br/><br/><table>
	<tr>
		<td colspan="2">find test users</td>
	</tr>
	<tr>
		<td>ID?</td>
		<td>NAME</td>
	</tr>
	<tr>
		<td>$TestID=</td>
		<td>Ben</td>
	</tr>
	<tr>
		<td>$TestID2=</td>
		<td>Sarah</td>
	</tr>
</table>
<br/>Before we proceed we validate that Ben and Sarah still live in the old Cities: Denver and Paris<br/><br/><table>
	<tr>
		<td colspan="2">check first city of users</td>
	</tr>
	<tr>
		<td>ID</td>
		<td>CITY?</td>
	</tr>
	<tr>
		<td>$TestID</td>
		<td>Denver</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td>Paris</td>
	</tr>
</table>
<br/><br/><h3>2 Execution some business functions</h3>
<br/>Here calls to your business code will go.<br/>A simple update statement which can do the job is given below.<br/><table>
	<tr>
		<td colspan="3">relocate users</td>
	</tr>
	<tr>
		<td>ID</td>
		<td>NewCITY</td>
		<td>Count?</td>
	</tr>
	<tr>
		<td>$TestID</td>
		<td>HongKong</td>
		<td>1</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td>Tokyo</td>
		<td>1</td>
	</tr>
</table>
<br/><br/><h3>3 Validating the impact on the test data</h3>
<br/>Finally we check that Ben now lives in Hong Kong and Sarah in Tokyo<br/><br/><table>
	<tr>
		<td colspan="2">Check city after relocation</td>
	</tr>
	<tr>
		<td>ID</td>
		<td>CITY?</td>
	</tr>
	<tr>
		<td>$TestID</td>
		<td>HongKong</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td>Tokyo</td>
	</tr>
</table>
<br/><div class="collapsible closed"><ul><li><a href='#' class='expandall'>Expand</a></li><li><a href='#' class='collapseall'>Collapse</a></li></ul>
	<p class="title">Included page: <a href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.WritingGenericRequirementsWithAlias.SqlTearDown.html">&gt;SqlTearDown</a> <a href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.WritingGenericRequirementsWithAlias.SqlTearDown?edit&amp;redirectToReferer=true&amp;redirectAction=.html" class="edit"></a></p>
	<div><h3>Rollback the change to not impact future tests</h3>
<br/><table>
	<tr>
		<td>Script</td>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>debug</td>
	</tr>
	<tr>
		<td colspan="4">open Connection</td>
	</tr>
	<tr>
		<td>execute</td>
		<td colspan="3">rollback</td>
	</tr>
	<tr>
		<td colspan="4">close Connection</td>
	</tr>
</table>
<br/><h4>Check that the rollback worked</h4>
<table>
	<tr>
		<td>SQLCommand</td>
		<td>TransactionDatabase</td>
		<td>select City from TestData where ID ='%ID%'</td>
	</tr>
	<tr>
		<td>ID</td>
		<td colspan="2">CITY?</td>
	</tr>
	<tr>
		<td>$TestID</td>
		<td colspan="2">Denver</td>
	</tr>
	<tr>
		<td>$TestID2</td>
		<td colspan="2">Paris</td>
	</tr>
</table>
</div>
</div>
<br/><div class="contents">
	<b>Contents:</b>
	<ul class="toc1">
		<li>
			<a href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.WritingGenericRequirementsWithAlias.SqlSetUp.html" class="static">Sql Set Up</a>
		</li>
		<li>
			<a href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.WritingGenericRequirementsWithAlias.SqlSetup.html" class="static">Sql Setup</a>
		</li>
		<li>
			<a href="PlugIns.JdbcSlim.UserGuide.1ASimpleExample.WritingGenericRequirementsWithAlias.SqlTearDown.html" class="static">Sql Tear Down</a>
		</li>
	</ul>
</div>
<br/></article></body></html>